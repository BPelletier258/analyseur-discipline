<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Analyseur Discipline — Filtrage par article</title>
  {{ css|safe }}
</head>
<body>
  <div class="wrap">
    <h1>Analyseur Discipline – Filtrage par article</h1>

    <div class="note">
      <strong>Règles&nbsp;:</strong> détection exacte de l’article. Si la 1<sup>re</sup> cellule contient « <code>Article filtré&nbsp;:</code> », on ignore la 1<sup>re</sup> ligne (lignes d’en-têtes sur la 2<sup>e</sup>).
    </div>

    <form class="formbar" action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
      <div class="formgrid">
        <div class="formcol">
          <label for="article">Article à rechercher (ex. <code>29, 59(2)</code>)</label>
          <input id="article" type="text" name="article" placeholder="29, 59(2)" value="{{ article or '' }}" />
          <label>
            <input type="checkbox" name="only_segment" value="1" {% if only_segment %}checked{% endif %}>
            Afficher uniquement le segment contenant l’article dans les 4 colonnes d’intérêt
          </label>
          <div style="font-size:13px;color:#475569">Formats : <code>.xlsx</code> / <code>.xlsm</code></div>
        </div>

        <div class="formcol">
          <label for="file">Fichier Excel</label>
          <input id="file" type="file" name="file" accept=".xlsx,.xlsm" />
        </div>

        <div class="formcol" style="align-items:flex-end;">
          <button type="submit">Analyser</button>
        </div>
      </div>
    </form>

    {% if error %}
      <div class="note" style="border-color:#fecaca;background:#fff1f2;color:#991b1b">
        <strong>Erreur :</strong> {{ error }}
      </div>
    {% endif %}

    <p>
      <a href="{{ url_for('download') }}" class="btn">
        <button type="button">Télécharger le résultat (Excel)</button>
      </a>
    </p>

    {% if html_table %}
      {{ html_table|safe }}
    {% endif %}
  </div>
</body>
</html>
