<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Analyseur Discipline – Filtrage par article</title>
  {{ css|safe }}
</head>
<body>

<div class="wrap">
  <h1>Analyseur Discipline – Filtrage par article</h1>

  <div class="note">
    <strong>Règles :</strong> détection exacte de l’article.
    Si la 1<sup>re</sup> cellule contient « <code>Article filtré :</code> », on ignore la 1<sup>re</sup> ligne (lignes d’en-têtes sur la 2<sup>e</sup>).
  </div>

  {% if error %}
    <div class="note" style="border-color:#fda4af;background:#ffe4e6;color:#991b1b">
      {{ error }}
    </div>
  {% endif %}

  <div class="formbar">
    <form id="analyzeForm" action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
      <div class="formgrid">
        <div class="formcol">
          <label>Article à rechercher (ex. <code>29</code>, <code>59(2)</code>)</label>
          <input type="text" name="article" value="{{ article or '' }}" placeholder="29, 59(2)" required>

          <label style="display:flex;align-items:center;gap:8px;margin-top:6px;">
            <input type="checkbox" name="only_segment" {% if only_segment %}checked{% endif %}>
            Afficher uniquement le segment contenant l’article dans les 4 colonnes d’intérêt
          </label>

          <div style="font-size:12px;color:#475569;margin-top:4px">
            Formats : <code>.xlsx</code> / <code>.xlsm</code>
          </div>
        </div>

        <div class="formcol">
          <label>Fichier Excel</label>
          <input type="file" name="file" required>
        </div>

        <div class="formcol">
          <button type="submit" style="margin-top:24px;">Analyser</button>
        </div>
      </div>
    </form>
  </div>

  {% if html_table %}
    <div style="margin:12px 0 8px">
      <a href="{{ url_for('download') }}"
         style="background:#0ea5e9;color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;">
        Télécharger le résultat (Excel)
      </a>
    </div>
    {{ html_table|safe }}
  {% endif %}
</div>

<!-- Overlay sablier -->
<div id="busy" class="busy" aria-hidden="true">
  <div class="spinner" aria-hidden="true"></div>
  <div class="busy-text">Analyse en cours…</div>
</div>

<script>
  // Affiche l’overlay dès qu’on soumet le formulaire ; il disparaît à l’affichage du résultat.
  document.getElementById('analyzeForm')?.addEventListener('submit', function () {
    const b = document.getElementById('busy');
    if (b) b.style.display = 'flex';
  });
</script>

</body>
</html>
